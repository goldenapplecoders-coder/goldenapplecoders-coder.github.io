<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cross DJ - Professional Virtual DJ Studio</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        :root {
            --primary: #8e44ad;
            --secondary: #3498db;
            --dark: #1a1a2e;
            --darker: #16213e;
            --light: #f5f5f5;
            --accent: #e74c3c;
            --success: #2ecc71;
            --warning: #f39c12;
        }

        body {
            background: linear-gradient(135deg, var(--dark), var(--darker));
            color: var(--light);
            min-height: 100vh;
            overflow-x: hidden;
        }

        .container {
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            padding: 20px;
            max-width: 1600px;
            margin: 0 auto;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            margin-bottom: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logo h1 {
            font-size: 2rem;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: 700;
        }

        .logo i {
            font-size: 2.5rem;
            color: var(--primary);
        }

        .status-bar {
            display: flex;
            gap: 20px;
            font-size: 0.9rem;
            color: #aaa;
        }

        .status-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .status-item i {
            color: var(--success);
        }

        .main-content {
            display: flex;
            flex: 1;
            gap: 20px;
        }

        .library-panel {
            flex: 0 0 320px;
            background: rgba(0, 0, 0, 0.4);
            border-radius: 10px;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .panel-header h2 {
            font-size: 1.3rem;
            color: var(--secondary);
        }

        .file-input-container {
            margin-bottom: 15px;
        }

        #file-input {
            display: none;
        }

        .file-input-label {
            display: block;
            background: var(--primary);
            color: white;
            padding: 12px 20px;
            border-radius: 5px;
            text-align: center;
            cursor: pointer;
            transition: background 0.3s;
            font-weight: 500;
        }

        .file-input-label:hover {
            background: #7d3c98;
        }

        .file-input-label i {
            margin-right: 8px;
        }

        .search-box {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 8px 15px;
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .search-box input {
            background: transparent;
            border: none;
            color: var(--light);
            width: 100%;
            outline: none;
        }

        .library-list {
            flex: 1;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 10px;
            max-height: 400px;
        }

        .empty-playlist {
            text-align: center;
            padding: 30px;
            color: #777;
        }

        .empty-playlist i {
            font-size: 3rem;
            margin-bottom: 15px;
            color: #555;
        }

        .track-item {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            padding: 12px;
            cursor: pointer;
            transition: background 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .track-item:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .track-item.active {
            background: rgba(142, 68, 173, 0.3);
            border-left: 3px solid var(--primary);
        }

        .track-item i {
            color: var(--secondary);
            font-size: 1.2rem;
        }

        .track-info {
            flex: 1;
        }

        .track-title {
            font-weight: 600;
            margin-bottom: 5px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .track-details {
            display: flex;
            justify-content: space-between;
            font-size: 0.8rem;
            color: #aaa;
        }

        .dj-panel {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .decks-container {
            display: flex;
            gap: 20px;
            flex: 1;
        }

        .deck {
            flex: 1;
            background: rgba(0, 0, 0, 0.4);
            border-radius: 10px;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .deck-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .deck-title {
            font-size: 1.2rem;
            color: var(--secondary);
        }

        .waveform {
            height: 100px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            position: relative;
            overflow: hidden;
        }

        .waveform canvas {
            width: 100%;
            height: 100%;
        }

        .playhead {
            position: absolute;
            top: 0;
            left: 0;
            width: 2px;
            height: 100%;
            background: var(--accent);
            z-index: 10;
        }

        .deck-controls {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .play-controls {
            display: flex;
            justify-content: center;
            gap: 15px;
        }

        .control-btn {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background 0.3s;
            border: none;
            color: var(--light);
            font-size: 1.2rem;
        }

        .control-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .control-btn.play {
            background: var(--success);
        }

        .control-btn.play.playing {
            background: var(--accent);
        }

        .control-btn.cue {
            background: var(--warning);
        }

        .pitch-control {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .slider-container {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .slider-container label {
            font-size: 0.9rem;
            color: #aaa;
            width: 60px;
        }

        input[type="range"] {
            flex: 1;
            height: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            outline: none;
            -webkit-appearance: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: var(--secondary);
            cursor: pointer;
        }

        .eq-controls {
            display: flex;
            gap: 15px;
        }

        .eq-band {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }

        .eq-band label {
            font-size: 0.8rem;
            color: #aaa;
        }

        .eq-slider {
            height: 120px;
            -webkit-appearance: slider-vertical;
            width: 8px;
        }

        .mixer-panel {
            background: rgba(0, 0, 0, 0.4);
            border-radius: 10px;
            padding: 20px;
            display: flex;
            gap: 20px;
        }

        .channel-fader {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }

        .channel-fader label {
            font-size: 0.9rem;
            color: #aaa;
        }

        .crossfader-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            width: 100px;
        }

        .crossfader {
            height: 120px;
            -webkit-appearance: slider-vertical;
            width: 8px;
        }

        .bpm-display {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--success);
        }

        footer {
            margin-top: 20px;
            padding: 15px 0;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            text-align: center;
            color: #aaa;
            font-size: 0.9rem;
        }

        @media (max-width: 1200px) {
            .main-content {
                flex-direction: column;
            }
            
            .library-panel {
                flex: 0 0 auto;
                max-height: 300px;
            }
            
            .decks-container {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">
                <i class="fas fa-compact-disc"></i>
                <h1>Cross DJ</h1>
            </div>
            <div class="status-bar">
                <div class="status-item">
                    <i class="fas fa-circle"></i>
                    <span>Online</span>
                </div>
                <div class="status-item">
                    <i class="fas fa-microchip"></i>
                    <span>CPU: 24%</span>
                </div>
                <div class="status-item">
                    <i class="fas fa-hdd"></i>
                    <span>Storage: 2.3GB Free</span>
                </div>
            </div>
        </header>

        <div class="main-content">
            <div class="library-panel">
                <div class="panel-header">
                    <h2>Music Library</h2>
                </div>
                
                <div class="file-input-container">
                    <label for="file-input" class="file-input-label">
                        <i class="fas fa-folder-open"></i> Select Music Files
                    </label>
                    <input type="file" id="file-input" accept="audio/*" multiple>
                </div>
                
                <div class="search-box">
                    <i class="fas fa-search"></i>
                    <input type="text" id="search-input" placeholder="Search tracks...">
                </div>
                
                <div class="library-list" id="playlist">
                    <div class="empty-playlist">
                        <i class="fas fa-music"></i>
                        <p>Your playlist is empty</p>
                        <p>Select music files to get started</p>
                    </div>
                </div>
            </div>

            <div class="dj-panel">
                <div class="decks-container">
                    <div class="deck" id="deck-a">
                        <div class="deck-header">
                            <div class="deck-title">Deck A</div>
                            <div class="bpm-display">
                                <span id="bpm-a">--</span>
                                <i class="fas fa-tachometer-alt"></i>
                            </div>
                        </div>
                        <div class="waveform" id="waveform-a">
                            <div class="playhead" id="playhead-a"></div>
                        </div>
                        <div class="deck-controls">
                            <div class="play-controls">
                                <button class="control-btn cue" id="cue-a">
                                    <i class="fas fa-undo"></i>
                                </button>
                                <button class="control-btn play" id="play-a">
                                    <i class="fas fa-play"></i>
                                </button>
                                <button class="control-btn sync" id="sync-a">
                                    <i class="fas fa-sync"></i>
                                </button>
                            </div>
                            <div class="pitch-control">
                                <div class="slider-container">
                                    <label>Pitch</label>
                                    <input type="range" id="pitch-a" min="-8" max="8" value="0" step="0.1">
                                </div>
                                <div class="slider-container">
                                    <label>Gain</label>
                                    <input type="range" id="gain-a" min="0" max="100" value="80">
                                </div>
                            </div>
                            <div class="eq-controls">
                                <div class="eq-band">
                                    <label>Low</label>
                                    <input type="range" class="eq-slider" id="eq-low-a" min="-24" max="12" value="0">
                                </div>
                                <div class="eq-band">
                                    <label>Mid</label>
                                    <input type="range" class="eq-slider" id="eq-mid-a" min="-24" max="12" value="0">
                                </div>
                                <div class="eq-band">
                                    <label>High</label>
                                    <input type="range" class="eq-slider" id="eq-high-a" min="-24" max="12" value="0">
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="deck" id="deck-b">
                        <div class="deck-header">
                            <div class="deck-title">Deck B</div>
                            <div class="bpm-display">
                                <span id="bpm-b">--</span>
                                <i class="fas fa-tachometer-alt"></i>
                            </div>
                        </div>
                        <div class="waveform" id="waveform-b">
                            <div class="playhead" id="playhead-b"></div>
                        </div>
                        <div class="deck-controls">
                            <div class="play-controls">
                                <button class="control-btn cue" id="cue-b">
                                    <i class="fas fa-undo"></i>
                                </button>
                                <button class="control-btn play" id="play-b">
                                    <i class="fas fa-play"></i>
                                </button>
                                <button class="control-btn sync" id="sync-b">
                                    <i class="fas fa-sync"></i>
                                </button>
                            </div>
                            <div class="pitch-control">
                                <div class="slider-container">
                                    <label>Pitch</label>
                                    <input type="range" id="pitch-b" min="-8" max="8" value="0" step="0.1">
                                </div>
                                <div class="slider-container">
                                    <label>Gain</label>
                                    <input type="range" id="gain-b" min="0" max="100" value="80">
                                </div>
                            </div>
                            <div class="eq-controls">
                                <div class="eq-band">
                                    <label>Low</label>
                                    <input type="range" class="eq-slider" id="eq-low-b" min="-24" max="12" value="0">
                                </div>
                                <div class="eq-band">
                                    <label>Mid</label>
                                    <input type="range" class="eq-slider" id="eq-mid-b" min="-24" max="12" value="0">
                                </div>
                                <div class="eq-band">
                                    <label>High</label>
                                    <input type="range" class="eq-slider" id="eq-high-b" min="-24" max="12" value="0">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="mixer-panel">
                    <div class="channel-fader">
                        <label>Deck A</label>
                        <input type="range" class="eq-slider" id="volume-a" min="0" max="100" value="80">
                    </div>
                    <div class="crossfader-container">
                        <label>Crossfader</label>
                        <input type="range" class="crossfader" id="crossfader" min="0" max="100" value="50">
                    </div>
                    <div class="channel-fader">
                        <label>Deck B</label>
                        <input type="range" class="eq-slider" id="volume-b" min="0" max="100" value="80">
                    </div>
                </div>
            </div>
        </div>

        <footer>
            <p>Cross DJ Virtual Studio • Works Online & Offline • Professional DJ Software</p>
        </footer>
    </div>

    <script>
        // Global variables
        let playlist = [];
        let audioContext;
        let deckA = {
            audio: null,
            source: null,
            isPlaying: false,
            currentTrack: null,
            startTime: 0,
            pausedAt: 0,
            gainNode: null,
            playbackRate: 1.0
        };
        let deckB = {
            audio: null,
            source: null,
            isPlaying: false,
            currentTrack: null,
            startTime: 0,
            pausedAt: 0,
            gainNode: null,
            playbackRate: 1.0
        };

        // Initialize the DJ application
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize Web Audio API
            try {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
            } catch (e) {
                console.error('Web Audio API is not supported in this browser', e);
                alert('Web Audio API is not supported in your browser. Please use a modern browser like Chrome, Firefox, or Edge.');
            }

            // File input functionality
            const fileInput = document.getElementById('file-input');
            fileInput.addEventListener('change', handleFileSelect);

            // Search functionality
            const searchInput = document.getElementById('search-input');
            searchInput.addEventListener('input', filterPlaylist);

            // Deck A controls
            document.getElementById('play-a').addEventListener('click', () => togglePlay('a'));
            document.getElementById('cue-a').addEventListener('click', () => cueTrack('a'));
            document.getElementById('sync-a').addEventListener('click', () => syncTracks());
            
            // Deck B controls
            document.getElementById('play-b').addEventListener('click', () => togglePlay('b'));
            document.getElementById('cue-b').addEventListener('click', () => cueTrack('b'));
            document.getElementById('sync-b').addEventListener('click', () => syncTracks());

            // Volume controls
            document.getElementById('volume-a').addEventListener('input', () => updateVolume('a'));
            document.getElementById('volume-b').addEventListener('input', () => updateVolume('b'));
            document.getElementById('crossfader').addEventListener('input', updateCrossfader);

            // Pitch controls
            document.getElementById('pitch-a').addEventListener('input', () => updatePitch('a'));
            document.getElementById('pitch-b').addEventListener('input', () => updatePitch('b'));

            // Gain controls
            document.getElementById('gain-a').addEventListener('input', () => updateGain('a'));
            document.getElementById('gain-b').addEventListener('input', () => updateGain('b'));

            // EQ controls
            document.getElementById('eq-low-a').addEventListener('input', () => updateEQ('a'));
            document.getElementById('eq-mid-a').addEventListener('input', () => updateEQ('a'));
            document.getElementById('eq-high-a').addEventListener('input', () => updateEQ('a'));
            document.getElementById('eq-low-b').addEventListener('input', () => updateEQ('b'));
            document.getElementById('eq-mid-b').addEventListener('input', () => updateEQ('b'));
            document.getElementById('eq-high-b').addEventListener('input', () => updateEQ('b'));

            // Initialize gain nodes
            if (audioContext) {
                deckA.gainNode = audioContext.createGain();
                deckA.gainNode.connect(audioContext.destination);
                
                deckB.gainNode = audioContext.createGain();
                deckB.gainNode.connect(audioContext.destination);
                
                // Set initial volume
                updateVolume('a');
                updateVolume('b');
                updateCrossfader();
            }
        });

        // Handle file selection
        function handleFileSelect(event) {
            const files = event.target.files;
            if (files.length === 0) return;

            for (let i = 0; i < files.length; i++) {
                const file = files[i];
                if (!file.type.startsWith('audio/')) continue;

                const url = URL.createObjectURL(file);
                
                // Create a temporary audio element to get duration
                const audio = new Audio();
                audio.src = url;
                
                audio.addEventListener('loadedmetadata', function() {
                    const duration = formatTime(audio.duration);
                    
                    playlist.push({
                        name: file.name.replace(/\.[^/.]+$/, ""), // Remove file extension
                        file: file,
                        url: url,
                        duration: duration,
                        element: null
                    });
                    
                    updatePlaylist();
                });
            }
            
            // Reset file input to allow selecting the same files again
            event.target.value = '';
        }

        // Update the playlist UI
        function updatePlaylist() {
            const playlistElement = document.getElementById('playlist');
            
            if (playlist.length === 0) {
                playlistElement.innerHTML = `
                    <div class="empty-playlist">
                        <i class="fas fa-music"></i>
                        <p>Your playlist is empty</p>
                        <p>Select music files to get started</p>
                    </div>
                `;
                return;
            }
            
            playlistElement.innerHTML = '';
            
            playlist.forEach((track, index) => {
                const trackElement = document.createElement('div');
                trackElement.className = 'track-item';
                trackElement.dataset.index = index;
                
                trackElement.innerHTML = `
                    <i class="fas fa-music"></i>
                    <div class="track-info">
                        <div class="track-title">${track.name}</div>
                        <div class="track-details">
                            <span>${track.duration}</span>
                            <span>MP3</span>
                        </div>
                    </div>
                `;
                
                trackElement.addEventListener('click', function() {
                    // Remove active class from all tracks
                    document.querySelectorAll('.track-item').forEach(item => {
                        item.classList.remove('active');
                    });
                    
                    // Add active class to clicked track
                    this.classList.add('active');
                    
                    // Load track to the first available deck
                    if (!deckA.currentTrack) {
                        loadTrackToDeck('a', index);
                    } else if (!deckB.currentTrack) {
                        loadTrackToDeck('b', index);
                    } else {
                        // If both decks are occupied, replace the one that's not playing
                        if (!deckA.isPlaying) {
                            loadTrackToDeck('a', index);
                        } else {
                            loadTrackToDeck('b', index);
                        }
                    }
                });
                
                playlistElement.appendChild(trackElement);
                track.element = trackElement;
            });
        }

        // Filter playlist based on search input
        function filterPlaylist() {
            const searchTerm = document.getElementById('search-input').value.toLowerCase();
            
            playlist.forEach((track, index) => {
                const isVisible = track.name.toLowerCase().includes(searchTerm);
                track.element.style.display = isVisible ? 'flex' : 'none';
            });
        }

        // Load a track to a deck
        function loadTrackToDeck(deck, trackIndex) {
            const track = playlist[trackIndex];
            const deckObj = deck === 'a' ? deckA : deckB;
            
            // Stop current track if playing
            if (deckObj.source) {
                deckObj.source.stop();
                deckObj.source = null;
            }
            
            // Reset deck state
            deckObj.currentTrack = track;
            deckObj.pausedAt = 0;
            deckObj.startTime = 0;
            deckObj.playbackRate = 1.0;
            
            // Create audio buffer source
            if (audioContext) {
                fetch(track.url)
                    .then(response => response.arrayBuffer())
                    .then(arrayBuffer => audioContext.decodeAudioData(arrayBuffer))
                    .then(audioBuffer => {
                        deckObj.audio = audioBuffer;
                        
                        // Update deck UI
                        document.getElementById(`bpm-${deck}`).textContent = '--';
                        
                        // Reset pitch slider
                        document.getElementById(`pitch-${deck}`).value = 0;
                        
                        // Update play button
                        const playButton = document.getElementById(`play-${deck}`);
                        playButton.classList.remove('playing');
                        playButton.querySelector('i').className = 'fas fa-play';
                        
                        // Draw waveform
                        drawWaveform(deck, audioBuffer);
                    })
                    .catch(error => {
                        console.error('Error loading audio:', error);
                    });
            }
        }

        // Toggle play/pause for a deck
        function togglePlay(deck) {
            const deckObj = deck === 'a' ? deckA : deckB;
            
            if (!deckObj.audio) return;
            
            if (deckObj.isPlaying) {
                // Pause the track
                if (deckObj.source) {
                    deckObj.source.stop();
                    deckObj.source = null;
                    deckObj.pausedAt = audioContext.currentTime - deckObj.startTime;
                }
                deckObj.isPlaying = false;
                
                // Update UI
                const playButton = document.getElementById(`play-${deck}`);
                playButton.classList.remove('playing');
                playButton.querySelector('i').className = 'fas fa-play';
            } else {
                // Play the track
                if (audioContext.state === 'suspended') {
                    audioContext.resume();
                }
                
                deckObj.source = audioContext.createBufferSource();
                deckObj.source.buffer = deckObj.audio;
                deckObj.source.playbackRate.value = deckObj.playbackRate;
                deckObj.source.connect(deckObj.gainNode);
                
                deckObj.startTime = audioContext.currentTime - deckObj.pausedAt;
                deckObj.source.start(0, deckObj.pausedAt % deckObj.audio.duration);
                
                deckObj.isPlaying = true;
                
                // Update UI
                const playButton = document.getElementById(`play-${deck}`);
                playButton.classList.add('playing');
                playButton.querySelector('i').className = 'fas fa-pause';
                
                // Start updating playhead
                if (deck === 'a') {
                    requestAnimationFrame(() => updatePlayhead('a'));
                } else {
                    requestAnimationFrame(() => updatePlayhead('b'));
                }
                
                // Handle track end
                deckObj.source.onended = function() {
                    deckObj.isPlaying = false;
                    deckObj.pausedAt = 0;
                    
                    // Update UI
                    const playButton = document.getElementById(`play-${deck}`);
                    playButton.classList.remove('playing');
                    playButton.querySelector('i').className = 'fas fa-play';
                    
                    // Reset playhead
                    document.getElementById(`playhead-${deck}`).style.left = '0%';
                };
            }
        }

        // Cue a track (reset to beginning)
        function cueTrack(deck) {
            const deckObj = deck === 'a' ? deckA : deckB;
            
            if (!deckObj.audio) return;
            
            // If playing, stop and reset
            if (deckObj.isPlaying && deckObj.source) {
                deckObj.source.stop();
                deckObj.source = null;
            }
            
            deckObj.isPlaying = false;
            deckObj.pausedAt = 0;
            deckObj.startTime = 0;
            
            // Update UI
            const playButton = document.getElementById(`play-${deck}`);
            playButton.classList.remove('playing');
            playButton.querySelector('i').className = 'fas fa-play';
            
            // Reset playhead
            document.getElementById(`playhead-${deck}`).style.left = '0%';
        }

        // Sync tracks (set both to same BPM)
        function syncTracks() {
            // This is a simplified sync function
            // In a real app, you would analyze BPM and adjust accordingly
            if (deckA.isPlaying && deckB.isPlaying) {
                // Set both to the same playback rate (simplified)
                const targetRate = deckA.playbackRate;
                deckB.playbackRate = targetRate;
                
                if (deckB.source) {
                    deckB.source.playbackRate.value = targetRate;
                }
                
                document.getElementById('pitch-b').value = (targetRate - 1) * 100;
            }
        }

        // Update volume for a deck
        function updateVolume(deck) {
            const deckObj = deck === 'a' ? deckA : deckB;
            const volume = document.getElementById(`volume-${deck}`).value / 100;
            
            if (deckObj.gainNode) {
                deckObj.gainNode.gain.value = volume;
            }
        }

        // Update crossfader
        function updateCrossfader() {
            const crossfaderValue = document.getElementById('crossfader').value / 100;
            
            // Simple crossfader: when at 0, only deck A is heard; at 1, only deck B
            if (deckA.gainNode) {
                deckA.gainNode.gain.value = 1 - crossfaderValue;
            }
            
            if (deckB.gainNode) {
                deckB.gainNode.gain.value = crossfaderValue;
            }
        }

        // Update pitch (playback rate) for a deck
        function updatePitch(deck) {
            const deckObj = deck === 'a' ? deckA : deckB;
            const pitchValue = parseFloat(document.getElementById(`pitch-${deck}`).value);
            
            // Convert pitch percentage to playback rate
            // 0% = normal speed, positive = faster, negative = slower
            deckObj.playbackRate = 1 + (pitchValue / 100);
            
            if (deckObj.source) {
                deckObj.source.playbackRate.value = deckObj.playbackRate;
            }
            
            // Update BPM display (simplified)
            document.getElementById(`bpm-${deck}`).textContent = (128 * deckObj.playbackRate).toFixed(1);
        }

        // Update gain for a deck
        function updateGain(deck) {
            // In a real app, this would adjust the pre-fader gain
            // For simplicity, we'll just update the volume
            updateVolume(deck);
        }

        // Update EQ for a deck
        function updateEQ(deck) {
            // In a real app, this would apply EQ filters
            // This is a placeholder for the EQ functionality
            console.log(`EQ updated for deck ${deck}`);
        }

        // Update playhead position
        function updatePlayhead(deck) {
            const deckObj = deck === 'a' ? deckA : deckB;
            const playhead = document.getElementById(`playhead-${deck}`);
            
            if (deckObj.isPlaying && deckObj.audio) {
                const currentTime = audioContext.currentTime - deckObj.startTime;
                const progress = (currentTime / deckObj.audio.duration) * 100;
                playhead.style.left = `${Math.min(progress, 100)}%`;
                
                // Continue updating
                requestAnimationFrame(() => updatePlayhead(deck));
            }
        }

        // Draw a simple waveform visualization
        function drawWaveform(deck, audioBuffer) {
            const waveform = document.getElementById(`waveform-${deck}`);
            const canvas = document.createElement('canvas');
            canvas.width = waveform.clientWidth;
            canvas.height = waveform.clientHeight;
            
            // Clear any existing canvas
            while (waveform.firstChild) {
                if (waveform.firstChild.id === `playhead-${deck}`) {
                    break;
                }
                waveform.removeChild(waveform.firstChild);
            }
            
            waveform.appendChild(canvas);
            waveform.appendChild(document.getElementById(`playhead-${deck}`));
            
            const ctx = canvas.getContext('2d');
            const width = canvas.width;
            const height = canvas.height;
            
            // Get the audio data
            const data = audioBuffer.getChannelData(0);
            const step = Math.ceil(data.length / width);
            const amp = height / 2;
            
            // Draw the waveform
            ctx.fillStyle = 'rgba(255, 255, 255, 0.05)';
            ctx.fillRect(0, 0, width, height);
            
            ctx.strokeStyle = 'rgba(52, 152, 219, 0.7)';
            ctx.lineWidth = 2;
            ctx.beginPath();
            
            for (let i = 0; i < width; i++) {
                let min = 1.0;
                let max = -1.0;
                
                for (let j = 0; j < step; j++) {
                    const datum = data[(i * step) + j];
                    if (datum < min) min = datum;
                    if (datum > max) max = datum;
                }
                
                ctx.moveTo(i, (1 + min) * amp);
                ctx.lineTo(i, (1 + max) * amp);
            }
            
            ctx.stroke();
        }

        // Format time from seconds to MM:SS
        function formatTime(seconds) {
            if (isNaN(seconds)) return "00:00";
            
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }
    </script>
</body>
</html>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document Creator</title>
    <style>
        /* Basic styling for the editor */
        body {
            font-family: Arial, sans-serif;
            margin: 40px;
            line-height: 1.6;
        }
        #editor {
            width: 100%;
            height: 300px;
            padding: 15px;
            border: 1px solid #ccc;
            border-radius: 4px;
            margin-bottom: 20px;
            font-family: inherit;
            resize: vertical;
        }
        button {
            background-color: #4CAF50;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }
        button:hover {
            background-color: #45a049;
        }

        /* Modal styles - based on W3Schools example [citation:2] */
        .modal {
            display: none;
            position: fixed;
            z-index: 1;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.4);
        }
        .modal-content {
            background-color: #fefefe;
            margin: 10% auto;
            padding: 0;
            border: 1px solid #888;
            width: 90%;
            max-width: 500px;
            border-radius: 8px;
            box-shadow: 0 4px 8px 0 rgba(0,0,0,0.2);
            animation-name: animatetop;
            animation-duration: 0.4s;
        }
        @keyframes animatetop {
            from {top: -300px; opacity: 0}
            to {top: 0; opacity: 1}
        }
        .modal-header {
            padding: 16px;
            background-color: #5cb85c;
            color: white;
            border-top-left-radius: 8px;
            border-top-right-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .modal-header h2 {
            margin: 0;
        }
        .close {
            color: white;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            line-height: 1;
        }
        .close:hover {
            color: #eee;
        }
        .modal-body {
            padding: 20px;
        }
        .modal-footer {
            padding: 16px;
            background-color: #f5f5f5;
            border-bottom-left-radius: 8px;
            border-bottom-right-radius: 8px;
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }
        .form-group {
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
        }
        input[type="text"], select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
            font-size: 16px;
        }
        .input-with-dropdown {
            display: flex;
            gap: 10px;
        }
        .input-with-dropdown input {
            flex: 1;
        }
        .input-with-dropdown select {
            width: auto;
            min-width: 120px;
        }
        .warning {
            color: #d9534f;
            font-size: 14px;
            margin-top: 5px;
            display: none;
        }
        .btn-secondary {
            background-color: #6c757d;
        }
        .btn-secondary:hover {
            background-color: #5a6268;
        }
        .filename-preview {
            font-weight: bold;
            color: #2c3e50;
            word-break: break-all;
            margin: 15px 0;
            padding: 10px;
            background-color: #f8f9fa;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <!-- Main Editor -->
    <h1>Document Creator</h1>
    <textarea id="editor" placeholder="Start typing your document here..."></textarea>
    <button id="saveBtn">Save Document</button>

    <!-- Document Name Modal -->
    <div id="documentNameModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Save Document</h2>
                <span class="close" id="closeNameModal">&times;</span>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="filename">File Name:</label>
                    <div class="input-with-dropdown">
                        <input type="text" id="filename" placeholder="Enter file name">
                        <select id="extension">
                            <option value=".txt">.txt</option>
                            <option value=".pdf">.pdf</option>
                            <option value=".docx">.docx</option>
                            <option value=".html">.html</option>
                        </select>
                    </div>
                    <div id="extensionWarning" class="warning">
                        Please select a file extension from the dropdown.
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button id="cancelNameBtn" class="btn-secondary">Cancel</button>
                <button id="proceedToConfirmBtn">Next</button>
            </div>
        </div>
    </div>

    <!-- Confirmation Modal -->
    <div id="confirmationModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Confirm Save</h2>
                <span class="close" id="closeConfirmModal">&times;</span>
            </div>
            <div class="modal-body">
                <p>You are saving this file as <span id="filenamePreview" class="filename-preview"></span> on your device storage in Downloads.</p>
                <p>Click Save to continue or Discard to cancel.</p>
            </div>
            <div class="modal-footer">
                <button id="discardBtn" class="btn-secondary">Discard</button>
                <button id="finalSaveBtn">Save</button>
            </div>
        </div>
    </div>

    <script>
        // DOM Elements
        const saveBtn = document.getElementById('saveBtn');
        const documentNameModal = document.getElementById('documentNameModal');
        const confirmationModal = document.getElementById('confirmationModal');
        const closeNameModal = document.getElementById('closeNameModal');
        const closeConfirmModal = document.getElementById('closeConfirmModal');
        const cancelNameBtn = document.getElementById('cancelNameBtn');
        const proceedToConfirmBtn = document.getElementById('proceedToConfirmBtn');
        const discardBtn = document.getElementById('discardBtn');
        const finalSaveBtn = document.getElementById('finalSaveBtn');
        const filenameInput = document.getElementById('filename');
        const extensionSelect = document.getElementById('extension');
        const extensionWarning = document.getElementById('extensionWarning');
        const filenamePreview = document.getElementById('filenamePreview');

        // Open document name modal when Save button is clicked
        saveBtn.addEventListener('click', function() {
            documentNameModal.style.display = 'block';
        });

        // Close document name modal
        closeNameModal.addEventListener('click', closeNameModalFunc);
        cancelNameBtn.addEventListener('click', closeNameModalFunc);

        function closeNameModalFunc() {
            documentNameModal.style.display = 'none';
            // Reset form
            filenameInput.value = '';
            extensionWarning.style.display = 'none';
        }

        // Close confirmation modal
        closeConfirmModal.addEventListener('click', closeConfirmModalFunc);
        discardBtn.addEventListener('click', closeConfirmModalFunc);

        function closeConfirmModalFunc() {
            confirmationModal.style.display = 'none';
        }

        // Proceed to confirmation modal
        proceedToConfirmBtn.addEventListener('click', function() {
            const fileName = filenameInput.value.trim();
            
            // File extension validation using regex [citation:1][citation:4]
            const hasExtension = /\.\w+$/.test(fileName);
            
            if (hasExtension) {
                extensionWarning.style.display = 'none';
                // Show confirmation modal
                documentNameModal.style.display = 'none';
                filenamePreview.textContent = fileName;
                confirmationModal.style.display = 'block';
            } else {
                extensionWarning.style.display = 'block';
            }
        });

        // Final save functionality
        finalSaveBtn.addEventListener('click', function() {
            const content = document.getElementById('editor').value;
            const fileName = filenameInput.value.trim();
            
            // Create a blob and download the file [citation:8]
            const blob = new Blob([content], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = fileName;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            // Close modal and reset
            confirmationModal.style.display = 'none';
            filenameInput.value = '';
            alert('Document saved successfully!');
        });

        // Close modals when clicking outside
        window.addEventListener('click', function(event) {
            if (event.target === documentNameModal) {
                closeNameModalFunc();
            }
            if (event.target === confirmationModal) {
                closeConfirmModalFunc();
            }
        });

        // Auto-append selected extension if no extension is present
        extensionSelect.addEventListener('change', function() {
            const currentValue = filenameInput.value.trim();
            const hasExtension = /\.\w+$/.test(currentValue);
            
            if (!hasExtension && currentValue !== '') {
                filenameInput.value = currentValue + this.value;
            }
        });
    </script>
</body>
</html>
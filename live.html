<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Minimalist Camera</title>
    <style>
        /* Basic full-screen styling - you will need to expand this */
        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
            width: 100%;
            background-color: #000;
            overflow: hidden;
            font-family: sans-serif;
        }
        
        #cameraContainer {
            position: relative;
            width: 100vw;
            height: 100vh;
            background-color: #000;
        }
        
        #videoElement {
            /* Make video fill the container */
            width: 100%;
            height: 100%;
            object-fit: cover; /* This is key to maintaining aspect ratio while filling the screen[citation:1] */
            /* Optional: Flip front camera preview for more natural feel */
            /* transform: scaleX(-1); */
        }
        
        #controlsOverlay {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            padding: 20px 0;
            background: linear-gradient(transparent, rgba(0,0,0,0.5));
            display: flex;
            justify-content: space-around;
            align-items: center;
            box-sizing: border-box;
        }
        
        .controlBtn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            cursor: pointer;
            backdrop-filter: blur(10px);
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.2rem;
        }
        
        #captureBtn {
            width: 70px;
            height: 70px;
            background: white;
            color: #333;
        }
        
        #previewOverlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: black;
            display: none;
            flex-direction: column;
            justify-content: space-between;
        }
        
        #previewImage {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }
        
        #previewControls {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            padding: 20px 0;
            display: flex;
            justify-content: space-around;
            align-items: center;
        }
    </style>
</head>
<body>
    <div id="cameraContainer">
        <!-- Camera feed will be here -->
        <video autoplay playsinline id="videoElement"></video>
        
        <!-- Main shooting controls -->
        <div id="controlsOverlay">
            <button class="controlBtn" id="switchCameraBtn" title="Switch Camera">üîÑ</button>
            <button class="controlBtn" id="captureBtn" title="Take Picture">üì∑</button>
            <button class="controlBtn" id="toggleModeBtn" title="Switch to Video">üé•</button>
        </div>
        
        <!-- Preview and Save/Delete screen -->
        <div id="previewOverlay">
            <img id="previewImage" alt="Captured preview">
            <div id="previewControls">
                <button class="controlBtn" id="deleteBtn" style="background: #ff4757;">‚ùå</button>
                <button class="controlBtn" id="saveBtn" style="background: #2ed573;">üíæ</button>
            </div>
        </div>
    </div>

    <script>
        // State variables
        let currentStream = null;
        let currentFacingMode = 'user'; // 'user' for front, 'environment' for back
        let isVideoMode = false;
        let mediaRecorder = null;
        let recordedChunks = [];

        // DOM elements
        const videoElement = document.getElementById('videoElement');
        const captureBtn = document.getElementById('captureBtn');
        const switchCameraBtn = document.getElementById('switchCameraBtn');
        const toggleModeBtn = document.getElementById('toggleModeBtn');
        const previewOverlay = document.getElementById('previewOverlay');
        const previewImage = document.getElementById('previewImage');
        const deleteBtn = document.getElementById('deleteBtn');
        const saveBtn = document.getElementById('saveBtn');

        // Initialize camera
        async function initCamera() {
            stopCamera(); // Stop any existing stream first

            const constraints = {
                video: { 
                    facingMode: currentFacingMode,
                    width: { ideal: 1920 },
                    height: { ideal: 1080 }
                },
                audio: isVideoMode // Only request audio if in video mode
            };

            try {
                const stream = await navigator.mediaDevices.getUserMedia(constraints);
                currentStream = stream;
                videoElement.srcObject = stream;
                
                // Setup media recorder if in video mode
                if (isVideoMode) {
                    setupMediaRecorder(stream);
                }
            } catch (error) {
                console.error("Error accessing camera:", error);
                alert("Unable to access the camera. Please check permissions.");
            }
        }

        function stopCamera() {
            if (currentStream) {
                currentStream.getTracks().forEach(track => track.stop());
                currentStream = null;
            }
        }

        function setupMediaRecorder(stream) {
            // Browser-specific MIME type handling would be needed here for production
            const options = { mimeType: 'video/webm; codecs=vp9' };
            recordedChunks = [];

            try {
                mediaRecorder = new MediaRecorder(stream, options);

                mediaRecorder.ondataavailable = (event) => {
                    if (event.data.size > 0) {
                        recordedChunks.push(event.data);
                    }
                };

                mediaRecorder.onstop = () => {
                    const blob = new Blob(recordedChunks, { type: 'video/webm' });
                    // For video, you would trigger preview with the blob
                    // For this example, we'll just handle images
                };
            } catch (e) {
                console.error("MediaRecorder setup failed:", e);
            }
        }

        // Capture image
        function captureImage() {
            const canvas = document.createElement('canvas');
            const context = canvas.getContext('2d');
            
            // Set canvas dimensions to match video stream
            canvas.width = videoElement.videoWidth;
            canvas.height = videoElement.videoHeight;
            
            // Draw current video frame to canvas
            context.drawImage(videoElement, 0, 0, canvas.width, canvas.height);
            
            // Convert to Blob and trigger preview
            canvas.toBlob(blob => {
                const url = URL.createObjectURL(blob);
                previewImage.src = url;
                previewOverlay.style.display = 'flex';
                
                // Store the blob for saving later
                previewImage._capturedBlob = blob;
            }, 'image/jpeg', 0.8);
        }

        // Event listeners
        captureBtn.addEventListener('click', () => {
            if (isVideoMode) {
                // Handle video recording start/stop
                // This is a simplified version - you'd need more UI for recording state
                if (mediaRecorder && mediaRecorder.state === 'recording') {
                    mediaRecorder.stop();
                    captureBtn.textContent = 'üì∑';
                } else {
                    mediaRecorder.start();
                    captureBtn.textContent = '‚èπÔ∏è';
                }
            } else {
                captureImage();
            }
        });

        switchCameraBtn.addEventListener('click', () => {
            currentFacingMode = currentFacingMode === 'user' ? 'environment' : 'user';
            initCamera();
        });

        toggleModeBtn.addEventListener('click', () => {
            isVideoMode = !isVideoMode;
            toggleModeBtn.textContent = isVideoMode ? 'üì∑' : 'üé•';
            captureBtn.textContent = isVideoMode ? 'üé•' : 'üì∑';
            stopCamera();
            initCamera();
        });

        deleteBtn.addEventListener('click', () => {
            // Clean up and return to camera view
            if (previewImage.src) {
                URL.revokeObjectURL(previewImage.src);
            }
            previewOverlay.style.display = 'none';
            previewImage.removeAttribute('src');
        });

        saveBtn.addEventListener('click', () => {
            if (previewImage._capturedBlob) {
                // Create a download link and trigger it
                const url = URL.createObjectURL(previewImage._capturedBlob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `capture_${Date.now()}.jpg`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                
                // Clean up
                URL.revokeObjectURL(url);
                setTimeout(() => {
                    URL.revokeObjectURL(previewImage.src);
                    previewOverlay.style.display = 'none';
                    previewImage.removeAttribute('src');
                }, 100);
            }
        });

        // Start the camera when page loads
        window.addEventListener('load', initCamera);
        
        // Clean up when page is closed
        window.addEventListener('beforeunload', stopCamera);
    </script>
</body>
</html>